{"ast":null,"code":"import jwt from 'jsonwebtoken';\nimport { refreshToken } from '../../components/refreshToken/reducer';\nexport default function refreshTokenMiddleware() {\n  return function (_ref) {\n    var dispatch = _ref.dispatch,\n        getState = _ref.getState;\n    return function (next) {\n      return function (action) {\n        if (typeof action === 'function') {\n          var token = jwt.decode(localStorage.getItem('jwtToken'));\n          var refreshThreshold = Math.round(Date.now() / 1000);\n\n          if (token && refreshThreshold > token.exp) {\n            refreshToken(dispatch).then(function () {\n              return next(action);\n            }, function (err) {\n              throw err;\n            }).catch(function (err) {\n              return next(action);\n            });\n          } else {\n            return next(action);\n          }\n        } else {\n          return next(action);\n        }\n      };\n    };\n  };\n}","map":{"version":3,"sources":["C:/Users/User/Desktop/SiteMeeting/MeetingWebsite/MeetingWebsite/Frontend/src/store/middleware/refreshTokenMiddleware.js"],"names":["jwt","refreshToken","refreshTokenMiddleware","dispatch","getState","next","action","token","decode","localStorage","getItem","refreshThreshold","Math","round","Date","now","exp","then","err","catch"],"mappings":"AAAA,OAAOA,GAAP,MAAgB,cAAhB;AACA,SAAQC,YAAR,QAA2B,uCAA3B;AAEA,eAAe,SAASC,sBAAT,GAAiC;AAC5C,SAAO;AAAA,QAAGC,QAAH,QAAGA,QAAH;AAAA,QAAaC,QAAb,QAAaA,QAAb;AAAA,WAA4B,UAAAC,IAAI;AAAA,aAAI,UAACC,MAAD,EAAY;AACnD,YAAI,OAAOA,MAAP,KAAkB,UAAtB,EAAkC;AAC9B,cAAMC,KAAK,GAAGP,GAAG,CAACQ,MAAJ,CAAWC,YAAY,CAACC,OAAb,CAAqB,UAArB,CAAX,CAAd;AACA,cAAMC,gBAAgB,GAAIC,IAAI,CAACC,KAAL,CAAWC,IAAI,CAACC,GAAL,KAAa,IAAxB,CAA1B;;AACA,cAAIR,KAAK,IAAII,gBAAgB,GAAGJ,KAAK,CAACS,GAAtC,EAA2C;AACvCf,YAAAA,YAAY,CAACE,QAAD,CAAZ,CAAuBc,IAAvB,CAA4B,YAAM;AAC9B,qBAAOZ,IAAI,CAACC,MAAD,CAAX;AACH,aAFD,EAEG,UAAAY,GAAG,EAAG;AAAE,oBAAMA,GAAN;AAAY,aAFvB,EAGCC,KAHD,CAGO,UAACD,GAAD,EAAS;AACZ,qBAAOb,IAAI,CAACC,MAAD,CAAX;AACH,aALD;AAMH,WAPD,MAQI;AACA,mBAAOD,IAAI,CAACC,MAAD,CAAX;AACH;AACJ,SAdD,MAeI;AACA,iBAAOD,IAAI,CAACC,MAAD,CAAX;AACH;AACJ,OAnBsC;AAAA,KAAhC;AAAA,GAAP;AAoBH","sourcesContent":["import jwt from 'jsonwebtoken';\r\nimport {refreshToken} from '../../components/refreshToken/reducer';\r\n\r\nexport default function refreshTokenMiddleware(){\r\n    return ({ dispatch, getState }) => next => (action) => {\r\n        if (typeof action === 'function') {\r\n            const token = jwt.decode(localStorage.getItem('jwtToken'))\r\n            const refreshThreshold = (Math.round(Date.now() / 1000));\r\n            if (token && refreshThreshold > token.exp) {\r\n                refreshToken(dispatch).then(() => {\r\n                    return next(action)\r\n                }, err=> { throw err; })\r\n                .catch((err) => {\r\n                    return next(action)\r\n                });\r\n            }\r\n            else{\r\n                return next(action);\r\n            }\r\n        }\r\n        else{\r\n            return next(action);\r\n        }\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}